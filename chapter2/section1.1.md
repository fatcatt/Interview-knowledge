##### 浏览器对网络资源缓存，有哪几种缓存策略

浏览器对网络资源的缓存通常通过 HTTP 响应头中的 Cache-Control 字段进行配置。以下是一些常见的 Cache-Control 配置选项：

- public： 表示响应可以被共享缓存（例如 CDN）存储，适用于公共资源，如样式表和脚本。

- private： 表示响应只能在客户端进行缓存，不适用于共享缓存。这通常用于包含用户个人信息的响应。

- no-store： 表示不缓存响应，每次请求都要从服务器获取最新内容，适用于敏感数据或不希望被缓存的内容。

- no-cache： 表示缓存可以存在，但是否使用缓存则需要经过协商缓存来验证决定。浏览器在使用缓存之前必须向服务器验证资源的有效性，即使资源在缓存中仍然在期。通常会配合 ETag 或 Last-Modified 使用。

  1. Cache-Control: no-cache, max-age=3600 ETag: "abcdef12345"。
     首次访问： 当用户首次访问该资源时，浏览器会缓存资源，并记录缓存的过期时间（1 小时后）以及 ETag 的值。

  2. 再次访问： 当用户再次访问相同的资源时，浏览器会首先检查资源是否在缓存中，查看过期时间以及 ETag 的值。尽管 max-age 允许资源在 1 小时内不进行验证，但由于存在 no-cache 指令，浏览器会忽略 max-age 并要求服务器验证。

  3. 过期检查： 浏览器将发送一个条件请求给服务器，携带 If-None-Match 头，其中包含上次记录的 ETag 值。

  4. 服务器验证： 服务器收到条件请求后，会比较请求中的 ETag 与服务器上资源的当前 ETag 值。如果两者匹配，服务器返回状态码 304（Not Modified）并告诉浏览器使用缓存的资源。

  5. 资源更新： 如果资源的 ETag 值与服务器上的不匹配，服务器将返回新的资源内容，同时更新 ETag。

  6. 缓存更新： 浏览器将新的资源内容存储在缓存中，并更新缓存的过期时间和 ETag。

- must-revalidate： 表示客户端被允许在缓存过期的情况下可以缓存资源，发现缓存过期时，要发请求到服务端校验。

  - 例子：Cache-Control: max-age=86400, must-revalidate。缓存时间过了一天后，才会去服务端校验是否可继续使用/更新。与 no-cache 的区别是，no-cache 及时缓存不过期，也要去校验，并且可以 revalidate 对过期时间进行更新；

- max-age=秒数： 表示资源在客户端缓存中可以存在的最长时间，以秒为单位。例如，max-age=3600 表示资源可以缓存在客户端 1 小时。

##### 浏览器对 html、css、js 等不同网络资源的默认缓存策

- HTML 页面： HTML 页面通常不会被缓存，以确保用户获得最新的内容。可以使用缓存控制头（如 Cache-Control: no-cache）来覆盖此行为。

- CSS 和 JavaScript 文件： CSS 和 JavaScript 文件通常会被缓存，以减少加载时间。它们通常具有较长的缓存过期时间（例如，一周或一年），但如果服务器发送了适当的缓存控制头，浏览器会根据这些头信息来决定是否要获取新的文件。

- 图像、字体和媒体文件： 静态资源，如图像、字体和媒体文件，通常会被缓存，以提高网站性能。它们通常具有较长的缓存过期时间。

- XHR（XMLHttpRequest）和 Fetch 请求： 默认情况下，XMLHttpRequest 和 Fetch 请求不会缓存响应。但可以通过设置 Cache-Control 等头信息来控制缓存行为。

- Service Workers： 当使用 Service Workers 时，你可以完全控制资源的缓存策略，包括在离线时提供缓存的内容。
  - 浏览器的默认缓存策略可能会因浏览器类型和版本而有所不同。因此，在开发中，你可以通过设置适当的 HTTP 响应头（如 Cache-Control 和 Expires）来明确控制资源的缓存行为

##### js、css 等网络资源常常不是在前端手动发请求实现的，而是在加载时自动发送。如何设置这些资源的缓存？

- 通过构建工具： 如果你使用构建工具（如 Webpack）来打包和管理你的前端资源，你可以在构建配置中设置 Cache-Control。例如，你可以使用 Webpack 的 output 配置选项来设置生成的 JavaScript 或 CSS 文件的缓存策略。
  ```
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
    publicPath: '/assets/',
    // 设置 Cache-Control
    // 这里的 max-age 表示资源在客户端缓存中的有效期，单位是秒
    // 这个设置可以根据你的需求进行调整
    // 以下示例设置资源在客户端缓存中有效期为一天
    // max-age: 86400 秒 = 24 小时 * 60 分钟 * 60 秒
    cacheControl: 'public, max-age=86400',
  }
  ```
